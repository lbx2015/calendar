<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link type="include" href="/common/depcss.html" />
</head>
<body>
	<form class="layui-form" id="export" action="">
		<div class="layui-form-item">
			<div class="layui-input-inline" style="margin-left: 0;">
				<input class="layui-input" placeholder="开始日" id="LAY_demorange_s"
					name="start">
			</div>
			<div class="layui-input-inline">
				<input class="layui-input" placeholder="截止日" id="LAY_demorange_e"
					name="end">
			</div>
			<button class="layui-btn layui-btn layui-btn-normal fun_ exporttmpl_"
				onclick="exportDataTmpl();">AML报表导出</button>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">模块选择</label>
			<div class="layui-input-block">
				<input type="checkbox" name="mk" value="bigAmount" id="bigAmount"
					title="大额"> <input type="checkbox" name="mk" value="sus"
					id="sus" title="可疑">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">数据状态</label>
			<div class="layui-input-block">
				<input type="checkbox" name="zt" value="PRE_RECROD" title="待补录">
				<input type="checkbox" name="zt" value="PRE_SUBMIT" title="待提交">
				<input type="checkbox" name="zt-|-PRE_VERIFY" value="PRE_VERIFY"
					title="待审核"> <input type="checkbox" name="zt"
					value="PRE_EXPORT" title="待导出"> <input type="checkbox"
					name="zt" value="PRE_EXPORTOVER" title="已导出"> <input
					type="checkbox" name="zt" value="PRE_STORAGE" title="已入库">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">报文类型</label>
			<div class="layui-input-block">
				<input type="checkbox" name="bw" value="N" title="新增报文"> <input
					type="checkbox" name="bw" value="C" title="修改报文"> <input
					type="checkbox" name="bw" value="D" title="删除报文">
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn layui-btn layui-btn-normal fun_ export_"
					onclick="exportData()">数据导出</button>
				<button type="reset" class="layui-btn layui-btn-primary">重置</button>
			</div>
		</div>
	</form>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	$(function() {
		$("#add-data").click(function() {
			layer.open({
				type : 2,
				title : '新增数据',
				shadeClose : true,
				shade : false,
				maxmin : false, //开启最大化最小化按钮
				area : [ '100%', 'auto' ],
				offset : '0px',
				move : false,
				content : 'baseIndvCustEdit.html' //iframe的url
			});
			parent.startInit(document.getElementsByTagName("iframe")[0], 560);
		});

		var form = layui.form();
		//监听提交
		form.on('submit', function(data) {
			return false;
		});
	});
</script>
<script>
	layui.use('laydate', function() {
		var laydate = layui.laydate;

		var start = {
			min : laydate.now(),
			max : '2099-06-16 23:59:59',
			istoday : true,
			choose : function(datas) {
				end.min = datas; //开始日选好后，重置结束日的最小日期
				end.start = datas //将结束日的初始值设定为开始日
			}
		};

		var end = {
			min : laydate.now(),
			max : '2099-06-16 23:59:59',
			istoday : true,
			choose : function(datas) {
				start.max = datas; //结束日选好后，重置开始日的最大日期
			}
		};

		document.getElementById('LAY_demorange_s').onclick = function() {
			start.elem = this;
			laydate(start);
		}
		document.getElementById('LAY_demorange_e').onclick = function() {
			end.elem = this
			laydate(end);
		}
		var form = layui.form();
		//监听提交
		form.on('submit', function(data) {
			return false;
		});
	});
	
	 var star, end;
	 var userId=View.getRes().getUser().id;
	 var branchName = View.getRes().getUser().branch.branchName;
	//日期检查
	function checkStartAndEnd(){
	   	star = $("#LAY_demorange_s").val();
		end =$("#LAY_demorange_e").val(); 
		if (!star) {
			TmplUtils.showMsgFail("必须选择开始时间");
			return false;
		}else if (!end) {
			TmplUtils.showMsgFail("必须选结束时间");
			return false;
		}
		return true;
	}
	
	//aml报表导出
	function exportDataTmpl(){
	   if(checkStartAndEnd()){
	       window.open(Const.apiUrl+encodeURI("/dateReport/exportDataTmpl?star="+star+"&end="+end
		       +"&branchName="+branchName+"&userId="+userId+"&token="+View.TOKEN));
	   }
	}
	
	function exportData() {
		
	    if(!checkStartAndEnd()){
	    	return false;
	    }
		obj = document.getElementsByName("mk");
		var mk='';
		 for(var k=0; k< obj.length;k++){
	        if(obj[k].checked)
	           mk=(obj[k].value)+','+mk;
	    }
		 if(mk==''){
			 TmplUtils.showMsgFail("必须选择模块"); 
			 return false;
		 }
	    var zt='';
	    obj2 = document.getElementsByName("zt");
	    for(var k=0; k< obj2.length;k++){
	        if(obj2[k].checked)
	        	zt=(obj2[k].value)+','+zt;
	    } 
	    var bw='';
	    obj3 = document.getElementsByName("bw");
	    View.info(obj3);
	    for(var k=0; k< obj3.length;k++){
	        if(obj3[k].checked)
	        	bw=(obj3[k].value)+','+bw;
	    }
		window.open(Const.apiUrl + "/dateReport/exportData?star="+star+"&end="+end+"&mk="+mk+"&zt="+zt+"&bw="+bw+"&userId="+userId+"&token="+View.TOKEN);
		/* 
			if (resp.code == 500) {
				TmplUtils.showMsgFail("导入数据有误");
			} else {
				var url = Const.apiUrl + "/dateReport/downLoadExcel";
				window.open(url+"?path="+resp);
				TmplUtils.showMsgSuccess("导入成功");
			}
		}, function(code) {
			TmplUtils.showMsgFail('导入失败');
		});*/
	} 
		
		/* function getElements(name){
		    var returns = document.getElementsByName(name);
		    if(returns.length > 0) return returns;
		    returns = new Array();
		    var e = document.getElementsByTagName('input');
		    for(i = 0; i < e.length; i++) {
		        if(e[i].getAttribute("name") == name) {
		            returns[returns.length] = e[i];
		        }
		    }
		    return returns;
		} */
</script>
</html>