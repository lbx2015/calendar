<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>FBDS</title>
<link type="include" href="/common/core/depcss.html" />
</head>
<body>
	<div class="header">
		<div class="wrap">
			<div class="_tmpl nav-left" data-url="menu.html" data-attr=""
				data-bind="OnMenuBind" data-param=""></div>
			<div class="nav-right">
				<div class="nav">
					<span id="user_info1"></span>
				</div>
				<div class="nav-user">
					<ul class="layui-nav">
						<li class="layui-nav-item"><a href="javascript:;"
							id="user_info2"></a>
							<dl class="layui-nav-child">
								<!-- 二级菜单 -->
								<dd>
									<a href="javascript:openUserInfo();" id="preInfor"><i
										class="layui-icon">&#xe612;</i>个人中心</a>
								</dd>
								<dd>
									<a href="javascript:openEditPwd();" id="modify-pw"><i
										class="layui-icon">&#xe642;</i>修改密码</a>
								</dd>
								<dd>
									<a href="javascript:logOut();"><i
										class="iconfont icon-tuichu"></i>退出</a>
								</dd>
							</dl></li>
					</ul>
				</div>
			</div>
			<div class="clear"></div>
		</div>
	</div>

	<div class="mainContent" id="mainContent">
		<div class="wrap">
			<div class="layui-tab layui-tab-card">
				<ul class="layui-tab-title" id="layui-tab">
					<li class="layui-this"></li>
					<li>标签二</li>
					<li>标签三</li>
				</ul>
				<div class="crumbs" id="path"></div>
				<div class="quick-menu" id="shortcutMenu"></div>
				<div class="layui-tab-content" style="height: auto">
					<div class="layui-tab-item layui-show">
						<div class="iframeCont">
							<iframe frameborder="0" width="100%" height="100%" id="tab1"
								marginheight="0" marginwidth="0" scrolling="no"> </iframe>
						</div>
					</div>
					<div class="layui-tab-item" id="container2">
						<div class="iframeCont">
							<iframe frameborder="0" width="100%" height="100%" id="tab2"
								marginheight="0" marginwidth="0" scrolling="no"> </iframe>
						</div>
					</div>
					<div class="layui-tab-item" id="container3">
						<div class="iframeCont">
							<iframe frameborder="0" width="100%" height="100%" id="tab3"
								marginheight="0" marginwidth="0" scrolling="no"> </iframe>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="footer">
		<p>版权所有 © 悦锦软件系统（上海）有限公司 @ version1.2.001</p>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	startInit($("#tab1")[0], 560);
	startInit($("#tab2")[0], 560);
	startInit($("#tab3")[0], 560);

	//select选择监听
	var form = layui.form();
	$(function() {
	});

	form.on('select(menu1)', function(data) {
		changeOrgan(data.value);
	});

	function changeOrgan(key) {
		var org = View.getRes().getOrgan(key);
		$("#menu1").val(key);
		View.resetUi();
		document.title = org.name;
		$(".nav-left .layui-nav>li").removeClass("_m2select").hide();

		$(".nav-left .layui-nav>li").each(function(index) {
			var pid = $(this).data("pid");
			if (key == pid) {
				$(this).show();
				$(this).addClass("_m2select");
			}
		});
	}

	function logOut() {
		View.get(Const.ssoApiUrl + "/delToken", {}, function(resp) {
			window.location.href = "/delToken.html";
		});
	}

	//判断为首次密码
	function isFistLogin() {
		var isFirstPwd = View.getRes().getUser().isFirstPwd;
		if (isFirstPwd == 1) {
			openEditPwd(true);
		}
	}

	function openUserInfo() {
		layer.open({
			type : 2,
			title : "个人中心",
			shade : 0.3,
			area : [ '80%', '80%' ],
			maxmin : false,
			content : './myInfo.html#' + View.getRes().getUser().id,
			offset : 'auto'
		});
	}

	function openEditPwd(flag) {
		var params = {
			type : 2,
			title : "修改密码",
			shade : 0.3,
			area : [ '600px', '300px' ],
			maxmin : false,
			content : 'editPwd.html',
			offset : 'auto'
		};
		if (flag) {
			params.success = function() {
				TmplUtils.showMsgSuccess('您的密码为默认密码，请修改');
			};
		}
		layer.open(params);
	}

	function OnMenuBind(attrs, param) {
		var tp = this;
		tp.bind(function(callback) {
			View.onResLoad(function(res) {
				bindUserInfo(res);
				callback.call(tp, {
					"res" : res
				});
			});
		});
		tp.onFinish(function() {
			initMenu();
			changeOrgan(Const.sys.belongsOrgan);

			View.open("employeeList.html","员工管理");
		});
	}

	function bindUserInfo(res) {
		//所属机构 ：圣保罗全国 | 时间：2017-03-28
		var u = res.getUser();
		var info1 = "所属机构 ：" + u.branch.branchName;
		info1 += " | 时间：" + new Date().format("MM月dd日");
		$("#user_info1").text(info1);

		$("#user_info2").text("欢迎您：" + u.name);
	}

	function initMenu() {
		var items = $(".header .nav-left .layui-nav-item");
		items.mouseover(function() {
			$(this).children(".layui-nav-child").css("left",
					$(this).offset().left);
		});/*头部菜单left*/

		$(".layui-nav-child dd a").click(function() {
			$(".layui-nav-item dl").removeClass("layui-show");
		});
	}
</script>
<script id="shortcutTmpl" type="text/tmpl">
<span class="layui-breadcrumb" lay-separator="|">
{{#
	layui.each(d.shortMenus, function(index, m){
	if(index>=d.count){return}
}}
<a href="javascript:View.openMod({{=m.id }});" >{{=m.moduleName}}</a>
{{# }); }}
</span>
</script>
<script id="pathTmpl" type="text/tmpl">
<ul class="layui-breadcrumb layui-nav" lay-filter="">
	<li><a href="javascript:void(0)"><cite id="first-item">{{=d.fisrt}}</cite></a></li>
	<li class="layui-nav-item"><a href="javascript:"><cite id="second-item">{{=d.second}}</cite></a>
	<dl class="layui-nav-child" id="second-items">
		{{#
		layui.each(d.secondChildren, function(index, m){
		}}
		<dd><a href="javascript:View.openMod({{=m.id }});">{{=m.moduleName}}</a></dd>
		{{# }); }}
	</dl>
	</li>
	<li><a href="javascript:void(0)"><cite id="third-item">{{=d.third}}</cite></a></li>
</ul>
</script>
</html>