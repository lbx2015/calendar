<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>邮箱后缀列表页面</title>
    <link type="include" href="/common/depcss.html" />
</head>

<body class="iframeBody">
    <div class="content">
        <div class="layui-elem-field">
            <div class="group-button FL">
                <button class="layui-btn layui-btn-small layui-btn-danger ajax-all" id="deleteBtn" onclick="del()">
					<i class="layui-icon">&#xe640;</i> 删除
				</button>
                <button class="layui-btn layui-btn-normal layui-btn-small modal-full" id="add-data">
					<i class="layui-icon">&#xe608;</i> 添加
				</button>
				<button class="layui-btn layui-btn-normal layui-btn-small modal-full" onclick="addMore()" >
					<i class="layui-icon">&#xe608;</i> 批量添加
				</button>
            </div>
            <div class="_tmpl" data-url="filterCriteria.html" data-attr="emailSuffix.json" data-bind="filterCriteriaOnBind" data-param=""></div>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
        <div class="contentLeft layui-form">
            <div class="_tmpl" data-url="table.html" id="table" data-attr="emailSuffix.json" data-bind="tbOnBind" data-param="pindex=0&pcount=10"></div>
        </div>
        <div class="contentRight">
            <div class="_tmpl" data-url="preview.html" data-attr="emailSuffix.json" data-bind="previewOnBind" data-param=""></div>
        </div>
        <div style="clear: both"></div>
        <div class="_tmpl" data-url="pages.html" data-depend="table" data-attr="" data-bind="TmplUtils.pagesOnBind" data-param=""></div>
    </div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
    $(function() {
        $("#add-data").click(function() {
            var url = "emailSuffixEdit.html";
            var title = "添加数据";
            View.openDialog(url, title);
        });

        var form = layui.form();
        //监听提交，设置为不刷新页面
        form.on('submit', function(data) {
            return false;
        });
    });
</script>
<script>
    var form = layui.form(),
        layer = layui.layer;
    //全选
    form.on('checkbox(allChoose)', function(data) {
        var child = $(data.elem).parents('table').find(
            'tbody input[type="checkbox"]');
        child.each(function(index, item) {
            item.checked = data.elem.checked;
        });
        form.render('checkbox');
    });
</script>
<script>
    var item;
    var tbTmpl;

    function forbbit(id) {

    }

    function tbOnBind(attrs, param) {
        tmpl = this;
        tbTmpl = tmpl;

        var _bind = function(callback) {
            var url = Const.apiUrl + "/emailSuffix/getMore";
            var _this = this;
            var _succ = function(resp) {
                var data = {};
                if (resp) {
                    data.data = resp;
                    TmplUtils.totalPages = data.data.totalPages;
                }
                //是否需要全选checkbox
                data.hasCheckbox = true;
                //是否有操作列
                data.hasOperation = true;
                //操作按钮
                data.operations = [{
                     "value": "修改",
                     "onclick": "edit",
                     "class": "layui-btn layui-btn-mini layui-btn-normal"
                 }];
                //tr的点击事件绑定，该方法会传入item参数，不绑定改事件无预览效果
                data.trClick = "bindPro";
                //表格显示列数
                /* data.cellLeftCount = 4;
                 data.cellRightCount = 3;*/
                //表格各列显示比例
                /*data.tdLeftWidth = [ 10, 20, 30, 10 ];
                data.tdRightWidth = [ 30, 20, 50 ];*/

                //操作栏的宽度
                data.operationWidth = 5;
                callback.call(_this, data);
                if (TmplUtils.pageTmpl.refresh) {
                    TmplUtils.pageTmpl.refresh();
                }
                TmplUtils.tableOnLoad();
            };
            View.get(url, param, _succ, function(code) {
                TmplUtils.showMsgFail('查询出错');
            });
        }

        tmpl.bind(_bind);
    }

    //表格单元格点击事件
    function bindPro(item) {
        if (!TmplUtils.isEditing) {
            this.item = item;
            previewTmpl.refresh();
        }
    }

    //预览绑定
    var previewTmpl;

    function previewOnBind(attrs, param) {
        tmpl = this;
        previewTmpl = tmpl;
        if (!item) {
            return;
        }
        tmpl.bind(function(callback) {
            var url = Const.apiUrl + "/appUser/get";
            var data = {};
            //是否可编辑
            //data.canEdit = true;
            data.data = item;
            //绑定点击事件
            data.checkClick = "check";
            data.saveClick = "save";
            callback.call(this, data);
            TmplUtils.previewOnLoad();
        });
    }

    //查询条件绑定
    function filterCriteriaOnBind(attrs, param) {
        tmpl = this;
        var _this = this;
        tmpl.bind(function(callback) {
            var data = {};
            data.searchClick = "search";
            callback.call(_this, data);
            TmplUtils.filterCriteriaOnLoad();
        });
    }
    //查询
    function search() {
        TmplUtils.searchParam = Utils.formToStr("filterCriteria");
        tbTmpl.refresh("pindex=0" + "&pcount=" + TmplUtils.pageSize +
            TmplUtils.searchParam);
        TmplUtils.currPage = 1;
        TmplUtils.closePreview();
    }
    //弹出添加iframe
    function edit(id) {
        var url = "emailSuffixEdit.html?id=" + id;
        var title = "数据处理";
        View.openDialog(url, title);
    }

    //保存
    function save() {

        var url = Const.apiUrl + "/emailSuffix/addOrUpdate";
        var employee = Utils.formToObj("preview");
        View.post(url, employee, function(resp) {
            TmplUtils.showMsgSuccess('编辑成功');
            tbTmpl.refresh("pindex=" + (TmplUtils.currPage - 1) + "&pcount=" +
                TmplUtils.pageSize + TmplUtils.searchParam);
            TmplUtils.closePreview();
        }, function() {
            TmplUtils.showMsgFail('编辑失败');
        });
    }

    //删除
    function del() {
        TmplUtils.showConfirm('您确定删除该数据吗？', '确定', '取消', function() {
            var arrChk = $("input[name='tdCheckbox']");
            var ids = [];
            $(arrChk).each(function() {
                if ($(this).next('div').hasClass("layui-form-checked")) {
                    ids.push($(this).data("id"));
                }
            });
            var url = Const.apiUrl + "/emailSuffix/delMore"
            View.post(url, ids, function(resp) {
                TmplUtils.showMsgSuccess("删除成功");
                tbTmpl.refresh("pindex=" + (TmplUtils.currPage - 1) +
                    "&pcount=" + TmplUtils.pageSize +
                    TmplUtils.searchParam);
            }, function() {
                TmplUtils.showMsgFail('删除失败');
            });
        }, function() {

        });
    }
    function addMore(){
		var url = "emailSuffixAddMore.html";
        var title = "批量添加";
        View.openDialog(url, title);
    }
    
</script>

</html>