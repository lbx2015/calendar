<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>添加风险因素</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
</head>
<body>
	<div class="formbox layui-form add-formbox">
		<div class="_tmpl" data-url="edit.html" data-attr="riskFactorConfig.json"
			data-bind="editOnBind" data-param=""></div>
		<div class="layui-btn-div">
			<a class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit"
				href="javascript:edit();">保存</a>
			<a class="layui-btn layui-btn-primary layui-btn-mini"
				onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">取消</a>
		</div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	var id = window.location.hash.replace("#", "");
	var ids = id.replace("ss","");
	function editOnBind(attrs,param){
        tmpl = this;
        tmpl.bind(function (callback) {
            var _this = this;
            if(ids){
            	if(id==ids){
                    var url = Const.apiUrl+"/riskFactor/getes";
            	}else{
            		var url = Const.apiUrl+"/riskFactor/getees";
            	}
                var _this = this;
                View.get(url,"id="+ids,function (resp) {
                    var data={};
                    if(resp){
                        data.data = resp;
                    }
                    data.checkClick = "check";
                    data.saveClick = "edit";
                    callback.call(_this, data);
                    TmplUtils.editOnLoad();
                },function(){
                    TmplUtils.showMsgFail('风险因素获取失败');
				});
			}else{
                var data={};
                data.checkClick = "check";
                data.saveClick = "edit";
                callback.call(_this, data);
                TmplUtils.editOnLoad();
            }
        })
    }
	var riskFactorConfig = {};
	function check() {
		var editForms = $("form[name=edit]");
		editForms.each(function() {
			$.extend(riskFactorConfig, Utils.formToObj($(this).attr('id')))
		});
		if (!riskFactorConfig.factorCodeName.replace(" ", "")) {
			TmplUtils.showMsgFail('风险因素不能为空');
			return false;
		} else if(!riskFactorConfig.score.replace(" ", "")){
			TmplUtils.showMsgFail('风险状态分数不能为空');
			return false;
		} else {
			TmplUtils.showMsgSuccess('校验成功');
			return true;
		}
	}
	function edit() {
		if (!check()) {
			return;
		}if(id==ids){
			riskFactorConfig.id=ids;
			var url = Const.apiUrl + "/riskFactor/updatees";
		}else{
			riskFactorConfig.id=ids;
			var url = Const.apiUrl + "/riskFactor/addOrUpdatees";
		}
		View.post(url, riskFactorConfig, function(resp) {
			TmplUtils.showMsgSuccess('编辑成功');
			parent.tbTmpl.refresh("pindex=" + (parent.TmplUtils.currPage - 1)
					+ "&pcount=" + parent.TmplUtils.pageSize + parent.TmplUtils.searchParam);
			parent.previewTmpl.refresh();
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		}, function(code) {
			TmplUtils.showMsgFail('编辑失败');
		});
	}
</script>
</html>
