<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>可疑交易批量分析</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link type="include" href="/common/depcss.html" />
</head>
<body class="iframeBody">
<div class="formbox layui-form add-formbox">
	<div class="_tmpl" data-url="edit.html" data-attr="suspiciousTrans_susp.json"  data-bind="editOnBind" data-param=""></div>
	<div class="layui-btn-div">
		<a class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit" id="editMore"
			href="javascript:if(TmplUtils.check('edit')){edit();}" style="display:none;">提交</a>
		<a class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit"  id="approveMore"
			href="javascript:if(TmplUtils.check('edit')){approveMore();}" style="display:none;">审核</a>
		<a class="layui-btn layui-btn-primary layui-btn-mini" onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">返回</a>
	</div>
</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
var state =View.getQStr('state');
$(function(){
	if(state==1){
		$("#editMore").show();
	}else if(state==2){
		$("#approveMore").show();
	}
})
    function editOnBind(attrs,param){
        tmpl = this;
        tmpl.bind(function (callback) {
            var _this = this;
                var data={};
                data.checkClick = "check";
                data.saveClick = "edit";
                data.attrs = attrs.attrs;
                data.groups = attrs.groups;
                data.enums = attrs.enums;
                callback.call(_this, data);
                TmplUtils.editOnLoad();
        })
    }
    var amlSuspicious={};
    var user = View.getRes().getUser();
    //编辑保存
    function edit() {
      	 var editForms = $("form[name=edit]");
         editForms.each(function(){
             $.extend(amlSuspicious,Utils.formToObj($(this).attr('id')))
 		});
		var url = Const.apiUrl+"/suspiciousTrans/updateMore";
		var parentParamObj = View.kv2obj(parent.TmplUtils.searchParam);
		amlSuspicious.stcr = parentParamObj.stcr;
		amlSuspicious.ctid = parentParamObj.ctid;
		amlSuspicious.job ={};
		amlSuspicious.job.curJobState = parentParamObj.job.curJobState;
        View.post(url,amlSuspicious,function(resp){
        	if(resp==0){
      		   TmplUtils.showMsgSuccess('操作成功');    
      	   }else{
      		   TmplUtils.showMsgFail(resp+"条数据操作失败")
      	   }
			parent.tbTmpl.refresh("pindex="+(parent.TmplUtils.currPage-1)+"&pcount="+ TmplUtils.pageSize+ parent.TmplUtils.searchParam);
			parent.previewTmpl.refresh();
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		},function(code){
			TmplUtils.showMsgSuccess('操作失败');  
		});
	}
    
    function approveMore() {
   	 var editForms = $("form[name=edit]");
        editForms.each(function(){
            $.extend(amlSuspicious,Utils.formToObj($(this).attr('id')))
		});
		var parentParamObj = View.kv2obj(parent.TmplUtils.searchParam);
		amlSuspicious.stcr = parentParamObj.stcr;
		amlSuspicious.ctid = parentParamObj.ctid;
		amlSuspicious.job ={};
		amlSuspicious.job.curJobState = parentParamObj.job.curJobState;
		
		var url = Const.apiUrl+"/suspiciousTrans/approveMore";
       View.post(url,amlSuspicious,function(resp){
    	   if(resp==0){
    		   TmplUtils.showMsgSuccess('操作成功');    
    	   }else{
    		   TmplUtils.showMsgFail(resp+"条数据操作失败")
    	   }
			parent.tbTmpl.refresh("pindex="+(parent.TmplUtils.currPage-1)+"&pcount="+ TmplUtils.pageSize+ parent.TmplUtils.searchParam);
			parent.previewTmpl.refresh();
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		},function(code){
			TmplUtils.showMsgFail('操作失败');  
		});
	}
</script>
</html>
