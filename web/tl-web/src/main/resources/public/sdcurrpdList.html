<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>汇率list页面 </title>
<link type="include" href="/common/depcss.html" />
</head>

<body>
	<div class="content">
		<div class="layui-elem-field">
			<div class="group-button FL">
				<button
					class="layui-btn layui-btn-normal layui-btn-small modal-full fun_ addmore_"
					id="addMore-data" onclick="addMore()">
					<i class="layui-icon">&#xe608;</i>导入汇率
				</button>
				<button class="layui-btn layui-btn-small layui-btn-danger ajax-all fun_ del_" id="deleteBtn" onclick="del()">
					<i class="layui-icon">&#xe640;</i> 删除
				</button>
				<button
					class="layui-btn layui-btn-normal layui-btn-small modal-full fun_ add_"
					id="add-data">
					<i class="layui-icon">&#xe608;</i> 添加
				</button>
			</div>
			<div class="_tmpl" data-url="filterCriteria.html"
				data-attr="sdcurrpd.json" data-bind="filterCriteriaOnBind"
				data-param=""></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
		<div class="contentLeft layui-form">
			<div class="_tmpl" data-url="table.html" id="table"
				data-attr="sdcurrpd.json" data-bind="tbOnBind"
				data-param="pindex=0&pcount=10"></div>
		</div>
		<div class="contentRight">
			<div class="_tmpl" data-url="preview.html"
				data-attr="sdcurrpd.json" data-bind="previewOnBind"
				data-param=""></div>
		</div>
		<div style="clear: both"></div>
		<div class="_tmpl" data-url="pages.html"
			data-attr="sdcurrpd.json" data-depend="table" data-bind="TmplUtils.pagesOnBind" data-param=""></div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	$(function() {
		$("#add-data").click(function() {
			layer.open({
				type : 2,
				title : '添加数据',
                shadeClose: true,
                shade: false,
                maxmin: false, //开启最大化最小化按钮
                area: ['100%', 'auto'],
                offset: '0px',
                move: false,
				content : 'sdcurrpdEdit.html' //iframe的url
			});
			 parent.startInit(document.getElementsByTagName("iframe")[0], 560);  
		});

		var form = layui.form();
		//监听提交
		form.on('submit', function(data) {
			return false;
		});
	});
	//批量导入
	function addMore() {
		layer.open({
			type : 2,
			title : '导入汇率',
            shadeClose: true,
            shade: false,
            maxmin: false, //开启最大化最小化按钮
            area: ['100%', 'auto'],
            offset: '0px',
            move: false,
			content : 'sdcurrpdImport.html'
		});
        parent.startInit(document.getElementsByTagName("iframe")[0], 560);
	}
</script>
<script>
	var form = layui.form(), layer = layui.layer;
	//全选
	form.on('checkbox(allChoose)', function(data) {
		var child = $(data.elem).parents('table').find(
				'tbody input[type="checkbox"]');
		child.each(function(index, item) {
			item.checked = data.elem.checked;
		});
		form.render('checkbox');
	});
</script>
<script>
	function closePreview() {
		$(".contentLeft").removeClass("w1");
		$(".contentRight").removeClass("w2");
		$(".lay-tab-right").removeClass("w3");
	}
</script>
<script>

var item;
var tbTmpl;
function forbbit(id) {

}
function tbOnBind(attrs,param){
	tmpl = this;
	tbTmpl = tmpl;
	var data = {};
	if (param.listType == '2') {
		if (attrs.attrs.length >= 3) {
			attrs.attrs.splice(1, 1);
		}
		data.attrs = attrs.attrs;
	}
	tmpl.bind(function(callback) {
		var url = Const.apiUrl + "/sdcurrpdList/getMore";
		var _this = this;

		View.get(url, param, function(resp) {
			if (resp) {
				data.data = resp;
				TmplUtils.totalPages = data.data.totalPages;
				if(data.data.totalElements){
                    TmplUtils.totalCount = data.data.totalElements;
				}else{
                    TmplUtils.totalCount = 0;
				}
			}
			//是否需要全选checkbox
			data.hasCheckbox = true;
			data.hasOperation = true;
			//操作按钮
			data.operations = [ {
				value : "修改",
				onclick : "edit",
				'class':"layui-btn layui-btn-mini layui-btn-normal fun_ update_"
			} ];

			data.operationWidth = 5;
			//tr的点击事件绑定，该方法会传入id 参数
			data.trClick = "bindPro";
			callback.call(_this, data);
			if(TmplUtils.pageTmpl){
            	TmplUtils.pageTmpl.refresh();
			}
			TmplUtils.tableOnLoad();
		}, function(code) {
			TmplUtils.showMsgFail('查询出错');
		});
	});
}
//表格单元格点击事件
function bindPro(item){
    if(!TmplUtils.isEditing){
        this.item = item;
        previewTmpl.refresh();
    }
}

//预览绑定
var previewTmpl;
function previewOnBind(attrs,param) {
    tmpl = this;
    previewTmpl = tmpl;
    if(!item){
        return;
    }
    tmpl.bind(function(callback) {
        var url = Const.apiUrl+"/sdcurrpdList/get";
		var data={};
		//是否可编辑
		data.canEdit = true;
		data.data = item;
		//绑定点击事件
		data.checkClick = "check";
		data.saveClick = "save";
		callback.call(this, data);
		TmplUtils.previewOnLoad();
    });
}

//查询条件绑定
function filterCriteriaOnBind(attrs,param){
    tmpl = this;
    var _this = this;
    tmpl.bind(function (callback) {
        var data={};
        data.searchClick = "search";
        callback.call(_this, data);
        TmplUtils.filterCriteriaOnLoad();
    });
}
//查询
function search(){
    TmplUtils.searchParam = Utils.formToStr("filterCriteria");
    tbTmpl.refresh("pindex=0"+"&pcount="+ TmplUtils.pageSize +TmplUtils.searchParam);
    TmplUtils.currPage = 1;
    TmplUtils.closePreview();
}
//弹出添加iframe
 function edit(id){
    layer.open({
        type: 2,
        title: '添加数据',
        shadeClose: true,
        shade: false,
        maxmin: false, //开启最大化最小化按钮
        area: ['100%', 'auto'],
        offset: '0px',
        move: false,
        content: 'sdcurrpdEdit.html#'+id //iframe的url
    });
    parent.startInit(document.getElementsByTagName("iframe")[0], 560);
}


//自定义前段校验规则，可以多个
TmplUtils.verify.desc=function(value){
    if(value.length < 5){
        return '描述至少得5个字符啊';
    }
};
//预览校验
function check() {
}

//保存
function save() {
    var url = Const.apiUrl + "/sdcurrpdList/addOrUpdate";
    var baseCorpCust = Utils.formToObj("preview");
    View.post(url,baseCorpCust,function(resp){
        TmplUtils.showMsgSuccess('编辑成功');
        tbTmpl.refresh("pindex=" + (TmplUtils.currPage - 1) + "&pcount=" +  TmplUtils.pageSize + TmplUtils.searchParam);
        TmplUtils.closePreview();
    },function (){
    	TmplUtils.showMsgFail('编辑失败');
    })
}

//删除
	function del(){
		 var arrChk=$("input[name='tdCheckbox']");
	     var ids = [];
	     $(arrChk).each(function(){
	         if($(this).next('div').hasClass("layui-form-checked")){
	             ids.push($(this).data("id"));
	         }
	     });
	     if (ids == "") {
			TmplUtils.showMsgFail('请选择一条或多条数据');
			return;
		 }
    TmplUtils.showConfirm('您确定删除该数据吗？','确定','取消',function () {
        var url = Const.apiUrl + "/sdcurrpdList/delMore"
        View.post(url,ids,function(resp){
            TmplUtils.showMsgSuccess("删除成功");
            tbTmpl.refresh("pindex=" + (TmplUtils.currPage - 1) + "&pcount=" +  TmplUtils.pageSize + TmplUtils.searchParam);
        },function () {
            TmplUtils.showMsgFail('删除失败');
        });
    },function(){

	});
}
</script>
</html>