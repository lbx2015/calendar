<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>分数设置</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
<link rel="stylesheet" type="text/css" href="/css/ystep.css" />
</head>
<body class="iframeBody">
	<div class="formbox layui-form add-formbox">
		<div class="_tmpl" data-url="edit.html" data-attr="amlRuleEngineScore.json"
			data-bind="editOnBind" data-param=""></div>
		<div class="layui-btn-div" id="layui-btn-fixed">
			<button class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit"
				id="editButton">确定</button>
			<button class="layui-btn layui-btn-primary layui-btn-mini"
				onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">取消</button>
		</div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script type="text/javascript" src="/js/util/ystep.js"></script>
<script>
$(document).ready(function() {
	$("#editButton").click(function(){
		edit();
	})
});
var id = Tool.getQStr("id");
var tranFeaturesId = Tool.getQStr("tranFeaturesId");
function editOnBind(attrs,param){
    tmpl = this;
    tmpl.bind(function (callback) {
        var _this = this;
        if(id){
            var url = Const.apiUrl+"/amlRuleEngine/getScore";
            View.get(url,"id="+id,function (resp) {
                var data={};
                if(resp){
                	resp.tranFeaturesId = tranFeaturesId;
                    data.data = resp;
                }
                callback.call(_this, data);
                TmplUtils.editOnLoad();
            },function(){
                TmplUtils.showMsgFail('查询失败');
            });
        }else{
            var data={};
            callback.call(_this, data);
            TmplUtils.editOnLoad();
        }
    })
}

function edit(){
	if(!TmplUtils.check("edit")){
		return;
	}
	var ruleScore = Utils.formToObj("edit");
	var url = Const.apiUrl + "/amlRuleEngine/addAmlRuleEngineScore";
	View.post(url, ruleScore, function(resp) {
		TmplUtils.showMsgSuccess('编辑成功');
		parent.tbTmplAll.refresh("pindex=" + (parent.TmplUtils.currPage - 1)
				+ "&pcount=" + parent.TmplUtils.pageSize
				+ parent.TmplUtils.searchParam);
		parent.tbTmpl.refresh();
		parent.parent.tbTmpl.refresh("pindex="+ (parent.parent.TmplUtils.currPage - 1) +
				"&pcount="+ parent.parent.TmplUtils.pageSize + parent.parent.TmplUtils.searchParam);
		//setTimeout(function(){
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		//},50);
	}, function(code) {
		TmplUtils.showMsgFail('编辑失败');
	});
}

</script>
</html>