<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>黑白名单修改</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
</head>
<body class="iframeBody">
	<div class="formbox layui-form add-formbox">
		<div class="_tmpl" data-url="edit.html"
			data-attr="blackWhiteList.json" data-bind="editOnBind" data-param=""></div>
		<div class="layui-btn-div">
			<a class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit"
				href="javascript:javascript:if(TmplUtils.check('edit')){edit();}">保存</a>
			<a class="layui-btn layui-btn-primary layui-btn-mini"
				onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">返回</a>
		</div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
	var id = window.location.hash.replace("#", "");
	function editOnBind(attrs, param) {
		tmpl = this;
		tmpl.bind(function(callback) {
			var _this = this;
			for(var i = 0; i<attrs.attrs.length; i++){
				if(attrs.attrs[i].prop == "liskGroup"){
					attrs.attrs[i].type = "string";
					attrs.attrs[i].enum_url = "";
				}
			}
			if (id) {
				var url = Const.apiUrl + "/blackWhiteList/get";
				var _this = this;
				View.get(url, "id=" + id, function(resp) {
					var data = {};
					if (resp) {
						data.data = resp;
					}
					data.enums = attrs.enums;
					if (!data.enums[attrs.table]) {
						data.enums[attrs.table] = [];
					}
					for (var i = 0; i < resp.length; i++) {
						data.enums[attrs.table].push(resp[i]);
					}
					data.checkClick = "check";
					data.saveClick = "edit";
					callback.call(_this, data);
					TmplUtils.editOnLoad();

				}, function() {
					TmplUtils.showMsgFail('编辑失败');
				});
			} else {
				var data = {};
				callback.call(_this, data);
				TmplUtils.editOnLoad();
			}
		})
	}
	var blackWhiteList = {};
	//编辑保存
	function edit() {
		var blackWhiteList =  Utils.formToObj("edit");
		var url = Const.apiUrl + "/blackWhiteList/addOrUpdate";
		View.post(url, blackWhiteList, function(resp) {
			TmplUtils.showMsgSuccess('编辑成功');
			parent.tbTmpl.refresh("pindex=" + (parent.TmplUtils.currPage - 1)
					+ "&pcount=" + parent.TmplUtils.pageSize
					+ parent.TmplUtils.searchParam);
			parent.previewTmpl.refresh();
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		}, function(code) {
			TmplUtils.showMsgFail('编辑失败');
		});
	}
	var form = layui.form();
	form.on('select(listType)', function(data) {
		if (data.value == 2) {
			$(data.elem).parent("div").parent('div').next("div").hide();
		} else {
			$(data.elem).parent("div").parent('div').next("div").show();
		}
	});
</script>
</html>