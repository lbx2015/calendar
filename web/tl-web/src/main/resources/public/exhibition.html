<!doctype html>
<html>

<head>
<meta charset="utf-8">
<title>待办汇总</title>
<link type="include" href="/common/depcss.html" />
</head>
<body>
	<div class="content exhibitionBox">
		<fieldset class="layui-elem-field layui-elem-mg">
			<legend>查询日期</legend>
			<div class="layui-field-box">
				<div class="layui-form-item">
					<div class="layui-input-inline" style="margin-left: 0;">
						<input class="layui-input" placeholder="开始日" id="LAY_demorange_s">
					</div>
					<div class="layui-input-inline">
						<input class="layui-input" placeholder="截止日" id="LAY_demorange_e">
					</div>
					<div class="layui-input-inline">
						<button class="layui-btn" id="echarts_s" onclick="query()">查询</button>
					</div>
				</div>
			</div>
		</fieldset>
		<div class="clear"></div>
		<fieldset class="layui-elem-field layui-elem-mg">
			<legend>代办汇总</legend>
			<div class="layui-field-box">
				<ul class="dataList">
					<li>
						<div>
							<p>总交易</p>
							<span id="totalSpan"></span>
						</div>
					</li>
					<li><a href="javascript:" data-state="all" data-url="/bigAmount.html">
							<div>
								<p>大额交易量</p>
								<span id="bigAmountSpan"></span>
							</div>
					</a></li>
					<li><a href="javascript:" data-state="NoUp" data-url='/bigAmount.html'>
							<div>
								<p>大额待上报</p>
								<span id="bigWeiExportSpan"></span>
							</div>
					</a></li>
					<li><a href="javascript:" data-state="Up" data-url="/bigAmount.html">
							<div>
								<p>大额已上报</p>
								<span id="bigYiExportSpan"></span>
							</div>
					</a></li>
				</ul>
				<ul class="dataList">
					<li><a href="javascript:" data-state="end" data-url="/suspiciousManage.html">
							<div>
								<p>可疑不上报数</p>
								<span id="susDot"></span>
							</div>
					</a></li>
					<li><a href="javascript:" data-state="all" data-url="/suspiciousManage.html">
							<div>
								<p>可疑交易量</p>
								<span id="amlSuspiciousSpan"></span>
							</div>
					</a></li>
					<li><a href="javascript:" data-state="NoUp" data- data-url="/suspiciousManage.html">
							<div>
								<p>可疑待上报</p>
								<span id="susWeiExport"></span>
							</div>
					</a></li>
					<li><a href="javascript:" data-state="Up" data-url="/suspiciousManage.html">
							<div>
								<p>可疑已上报</p>
								<span id="susYiExport"></span>
							</div>
					</a></li>
				</ul>
			</div>
		</fieldset>
		<div class="clear"></div>
		<fieldset style="display:none;" class="layui-elem-field layui-elem-mg" >
			<legend>分析图表</legend>
			<div class="layui-field-box">
				<section class="panel">
					<header class="panel-heading bm0" style="display:none">
						<span class='span-title'>表1</span> <span class="tools pull-right"><a
							href="javascript:;" class="iconpx-chevron-down"></a></span>
					</header>
					<div id="customer" class="panel-body laery-seo-box"
						style="min-height: 400px">
						<div class="larry-seo-stats"></div>
					</div>
				</section>
				<section class="panel FR">
					<header class="panel-heading bm0" style="display:none">
						<span class='span-title'>表2</span> <span class="tools FR"><a
							href="javascript:;" class="iconpx-chevron-down"></a></span>
					</header>
					<div id="rose" class="panel-body laery-seo-box"
						style="min-height: 400px">
						<div class="larry-seo-stats"></div>
					</div>
				</section>
			</div>
			<div class="layui-field-box">
				<section class="panel" style="width: 100%;">
					<header class="panel-heading bm0" style="display:none">
						<span class='span-title'>表3</span> <span class="tools pull-right"><a
							href="javascript:;" class="iconpx-chevron-down"></a></span>
					</header>
					<div id="map" class="panel-body laery-seo-box"
						style="min-height: 400px">
						<div class="larry-seo-stats"></div>
					</div>
				</section>
			</div>
		</fieldset>
		<div class="clear"></div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>

	  $(function () {
		  var url = "/businessDay/get";
		  View.get(url,"date="+getSysDate()+"&count=6",function (data) {
			  if(data && data.length > 0){
				  $("#LAY_demorange_s").val(Utils.getDate(data[0]));
				  $("#LAY_demorange_s").prev("span").empty();
				  $("#LAY_demorange_e").val(Utils.getDate(data[data.length-1]));
				  $("#LAY_demorange_e").prev("span").empty();
				  query();
			  }
		  },function () {
			  TmplUtils.showMsgFail("时间获取失败");
		  })
	  });
	$(".layui-field-box").children("ul").children("li").children("a").click(
			function() {
				var state =$(this).data("state");
				$(this).data("url",$(this).data("url")+"?start="+$("#LAY_demorange_s").val()+"&end="+$("#LAY_demorange_e").val()+"&state="+state);
				View.open($(this).data("url"));
				parent.$("#layui-tab .layui-this").html(
						$(this).children("div").children("p").html());
				parent.$(".layui-nav-item dl").removeClass("layui-show");
				var a=$(this).children("div:first-child").children("p");
				parent.$("#third-item").html(a.text());
			});
	layui.use('laydate', function() {
		var laydate = layui.laydate;
		var start = {
			//min : laydate.now(),
			max : '2099-06-16 23:59:59',
			istoday : true,
			choose : function(datas) {
				end.min = datas; //开始日选好后，重置结束日的最小日期
				end.start = datas //将结束日的初始值设定为开始日
			}
		};
		var end = {
			//min : laydate.now(),
			max : '2099-06-16 23:59:59',
			istoday : true,
			choose : function(datas) {
				start.max = datas; //结束日选好后，重置开始日的最大日期
			}
		};

		document.getElementById('LAY_demorange_s').onclick = function() {
			start.elem = this;
			laydate(start);
		}
		document.getElementById('LAY_demorange_e').onclick = function() {
			end.elem = this
			laydate(end);
		}

	});

	
	//构造param
	function queryDate(start, end) {
		this.start = start;
		this.end = end
	}
	//获取时间
	function getSysDate() {
		var myDate = new Date(new Date().getTime()-24*60*60*1000);
		return Utils.getDate(myDate);
	}
	//获取当前日期前n天日期
	function getBeforeDate(n) {
		var n = n;
		var d = new Date();
		var year = d.getFullYear();
		var mon = d.getMonth() + 1;
		var day = d.getDate();
		if (day <= n) {
			if (mon > 1) {
				mon = mon - 1;
			} else {
				year = year - 1;
				mon = 12;
			}
		}
		d.setDate(d.getDate() - n);
		year = d.getFullYear();
		mon = d.getMonth() + 1;
		day = d.getDate();
		s = year + "-" + (mon < 10 ? ('0' + mon) : mon) + "-"
				+ (day < 10 ? ('0' + day) : day);
		return s;
	}

	function query() {
		var start = document.getElementById('LAY_demorange_s');
		var end = document.getElementById('LAY_demorange_e');
		var url = Const.apiUrl + "/exhibition/getCount";
		var param = new queryDate(start.value, end.value);
		View.get(url, param, function(resp) {
			//返回处理
			$("#totalSpan").text(resp.total);
			$("#bigAmountSpan").text(resp.bigAmount);
			$("#amlSuspiciousSpan").text(resp.amlSuspicious);
			$("#bigYiExportSpan").text(resp.bigYiExport);
			$("#bigWeiExportSpan").text(resp.bigWeiExport);
			$("#susYiExport").text(resp.susYiExport);
			$("#susWeiExport").text(resp.susWeiExport);
			$("#susDot").text(resp.susDot);
		}, function(code) {
			TmplUtils.showMsgFail('查询出错');
		});
	}
	
/* 	function bigAmount(){
		var start = document.getElementById('LAY_demorange_s');
		var end = document.getElementById('LAY_demorange_e');
		window.location.href="/bigAmount.html?start="+start+"&end="+end;
	} */
</script>
</html>