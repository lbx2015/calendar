<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>dialog2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link type="include" href="/common/depcss.html" />
</head>

<body>
    <div style="text-align: center;">
        <h1 id='title'></h1>
        <div style='width: 90%; margin:5%;'>
            <textarea id="reportNote"></textarea>
            <textarea id="reportRule"></textarea>
        </div>
    </div>
</body>
<link type="include" href="/common/depjs.html" />
<script type="text/javascript" src="{=ctx}/js/util/ystep.js"></script>
<script>
    var id = View.getQStr('id');
    var type = View.getQStr('type');

    function editOnBind(attrs, param) {
        tmpl = this;
        tmpl.bind(function(callback) {
            var _this = this;
            if (id) {
                var url = Const.apiUrl + "/reportList/get";
                var _this = this;
                View.get(url, "id=" + id, function(resp) {
                    var data = {};
                    if (resp) {
                        data.data = resp;
                    }
                    //默认展开分组 ，不配置默认展开第一个分组
                    data.showGroup = "base";
                    callback.call(_this, data);
                    TmplUtils.editOnLoad();
                    loadRichText(type);
                }, function() {
                    TmplUtils.showMsgFail('信息获取失败');
                });
            } else {
                var data = {};
                data.showGroup = "base";
                callback.call(_this, data);
                TmplUtils.editOnLoad();
                loadRichText(type);
            }
        });
    }
    $(function() {
        if (id) {
            var url = Const.apiUrl + "/reportList/get";
            var _this = this;
            View.get(url, "id=" + id, function(resp) {
                $("#reportNote").val(resp.reportNote);
                $("#reportRule").val(resp.reportRule);
                loadRichText(type);
            }, function() {
                TmplUtils.showMsgFail('信息获取失败');
            });
        }
    })

    function loadRichText(type) {
        layui.use('layedit', function() {
            var layedit = layui.layedit;
            layedit.set({
                tool: ['strong' //加粗
                    , 'italic' //斜体
                    , 'underline' //下划线
                    , 'del' //删除线
                    , '|' //分割线
                    , 'left' //左对齐
                    , 'center' //居中对齐
                    , 'right' //右对齐
                    , '|', 'link' //超链接
                    , 'unlink' //清除链接
                    , 'face' //表情
                    , 'image' //插入图片
                    //,'help' //帮助
                ],
                height: 500
            });
            if (type == "note") {
                $("#reportRule").hide();
                layedit.build('reportNote');
                $("#title").html("报文说明")
            } else {
                $("#reportNote").hide();
                layedit.build('reportRule'); //建立编辑器
                $("#title").html("报文规则")
            }

        });
    }
</script>

</html>