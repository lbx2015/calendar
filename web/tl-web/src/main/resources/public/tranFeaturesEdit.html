<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>交易特征编辑页面</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1">
    <link type="include" href="/common/depcss.html" />
</head>
<body class="iframeBody">
<div class="formbox layui-form add-formbox gz-formbox">
    <div class="_tmpl" data-url="edit.html" data-attr="TranFeatures.json"
         data-bind="editOnBind" data-param=""></div>
    <div class="layui-btn-div">
        <a class="layui-btn bgc1 layui-btn-mini" lay-submit lay-filter="edit"  id="submit" 
           href="javascript:if(TmplUtils.check('edit')){edit();}">确定</a>
        <!-- <button class="layui-btn layui-btn-mini layui-btn-normal" onclick="check()">校验</button> -->
        <a class="layui-btn layui-btn-primary layui-btn-mini"
           onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">取消</a>
    </div>
</div>
</body>
<link type="include" href="/common/depjs.html" />
<script>
    //var id = window.location.hash.replace("#","");
    var id = View.getQStr('id');
	var isShow = View.getQStr('isShow');
    function editOnBind(attrs,param){
        tmpl = this;
        tmpl.onFinish(function(data) {
            if(isShow==2){
				$('#submit').hide();
			}
		});
        tmpl.bind(function (callback) {
            var _this = this;
            if(id){
                var url = Const.apiUrl+"/tranFeatures/get";
                View.get(url,"id="+id,function (resp) {
                    var data={};
                    if(resp){
                        data.data = resp;
                    }
                    data.editable = isShow;
                    callback.call(_this, data);
                    TmplUtils.editOnLoad();
                },function(){
                    TmplUtils.showMsgFail('查询失败');
                });
            }else{
                var data={};
                callback.call(_this, data);
                TmplUtils.editOnLoad();
            }
        });
    }

    //编辑保存
    function edit() {
    	if(!TmplUtils.check("edit")){
    		return ;
    	}
        var crimeType = Utils.formToObj("edit");
        var url = Const.apiUrl+"/tranFeatures/addOrUpdate";
        View.post(url,crimeType,function(resp){
            TmplUtils.showMsgSuccess('编辑成功');
            parent.View.fireEvent("TB_DATA_CHANGE", {
                "window" : window.name
            });
        },function(code){
            TmplUtils.showMsgFail('编辑失败');
        });
    }
</script>
</html>