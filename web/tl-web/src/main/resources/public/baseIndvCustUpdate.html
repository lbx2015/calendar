<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>dialog2</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link type="include" href="/common/depcss.html" />
<link rel="stylesheet" type="text/css" href="{=ctx}/css/ystep.css" />
</head>
<body class="iframeBody">
	<div class="formbox layui-form add-formbox">
		<div class="_tmpl" data-url="edit.html" data-attr="baseIndvCust.json"
			data-bind="editOnBind" data-param=""></div>
		<div class="layui-btn-div" id="layui-btn-fixed">
			<div class="ystep4" id="flowsheet"></div>
			<button class="layui-btn bgc1 layui-btn-mini" lay-submit
					lay-filter="edit" id="submit">变更</button>
			<button class="layui-btn layui-btn-primary layui-btn-mini"
				onclick="parent.layer.close(parent.layer.getFrameIndex(window.name));">取消</button>
		</div>
	</div>
</body>
<link type="include" href="/common/depjs.html" />
<script type="text/javascript" src="{=ctx}/js/util/ystep.js"></script>
<script>
$(document).ready(function() {
	$("#submit").click(function() {
		if (TmplUtils.check('edit')) {
			edit();
		}
	});
});
var id = window.location.hash.replace("#", "");
	function editOnBind(attrs, param) {
		tmpl = this;
		tmpl.bind(function(callback) {
			var _this = this;
			if (id) {
				var url = Const.apiUrl + "/baseIndvCusts/get";
				var _this = this;
				View.get(url, "id=" + id, function(resp) {
					var data = {};
					if (resp) {
						data.data = resp;
					}
					//默认展开分组 ，不配置默认展开第一个分组
					data.showGroup = "base";
					callback.call(_this, data);
					TmplUtils.editOnLoad();
				}, function() {
					TmplUtils.showMsgFail('对私客户信息获取失败');
				});
			} else {
				var data = {};
				data.showGroup = "base";
				callback.call(_this, data);
				TmplUtils.editOnLoad();
			}
		});
		tmpl.onFinish(function(data) {
			var cls = [ "", "layui-btn-normal" ];
			var job = Work.getJob(data.data);
			var _html = job.getEventsHtml(cls);
			$("#wf_btns").html(_html);

			job.createFlowsheet($("#flowsheet"), function(job) {
				View.info("ok");
			});
		});
	}

	
	function edit() {
		var baseIndvCust = Utils.formToObj("edit");
		var url = Const.apiUrl + "/baseIndvCusts/update";
		View.post(url, baseIndvCust, function(resp) {
			if(resp==1){
				TmplUtils.showMsgSuccess('变更成功');
				}else{
					TmplUtils.showMsgFail('变更失败');
					}
			parent.View.fireEvent("TB_DATA_CHANGE", {
				"window" : window.name
			});
			
		}, function(code) {
			TmplUtils.showMsgFail('编辑失败');
		});
	}
 
</script>
</html>