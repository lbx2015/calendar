<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>提问</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link type="include" href="/common/depcss.html" />
</head>

<body class="iframeBody">
<div id = "content"></div>
</body>
<script type="text/javascript" src="{=ctx}/layui/layui.all.js"></script>
<script type="text/javascript" src="{=ctx}/js/util/utils.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/json2.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/base.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/base64_utf8.js"></script>
<script type="text/javascript" src="{=ctx}/js/util/tmplUtils.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/locale.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/view.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/workflow.js"></script>
<script type="text/javascript" src="{=ctx}/js/util/ystep.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/iefix.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/iframe.js"></script>
<script type="text/javascript" src="{=ctx}/js/core/resize.js"></script>
<script type="text/javascript" src="{=ctx}/js/util/jquery.mCustomScrollbar.concat.min.js"></script>
<script type="text/javascript">
	var _SYS = Tool.parseJSON('{=current_system}' || "{}");
	var Const = {
		urlConvert : "{=urlConvert}" == "true",
		sys : _SYS,
		apiUrl : _SYS.apiAccessUrl,
		webPath : "{=web_path}",
		ctx : "{=ctx}",
		security : "{=security}" == "true",
		ADEnable : "{=ADEnable}" == "true",
		ssoLoginUrl : "{=sso_login_url}",
		ssoLogoutUrl : "{=sso_logout_url}" == "" ? "{=sso_login_url}"
				: "{=sso_logout_url}",
		ssoApiUrl : "{=sso_api_url}",
		buttonFormat : 1
	//操作栏按钮格式，1表示图片按钮，2表示文字按钮
	}
	if (typeof isAuthIgnore == "undefined") {
		isAuthIgnore = false;
	}
	var token = Tool.getCookie("_TOKEN");
</script>
<script type="text/tmpl" id="tmpl">
<form action="" method="get" class="formbox layui-form parameterSet">
<input type="hidden" id="text" name="content">
<button type="button" class="layui-btn" id="save" lay-submit="" lay-filter="save" onclick="questionPublish()">保存</button>
<textarea id="richText" ></textarea>
</form>
</script>
<script>
var tmpl;
var layedit;
var index;
var userId = View.getQStr("userId");
var title = View.getQStr("title");
var topicId = View.getQStr("topicId");
layui.use('layedit', function(){
    layui.use('layedit', function(){
	layedit= layui.layedit;
   	layedit.set({
   	      			uploadImage: {
   	     				url: Const.apiUrl + '/tQuestion/upLoad'
   	      				,type: 'post'
   	    			}	
   	  				,tool: ['strong' //加粗
					  ,'italic' //斜体
					  ,'underline' //下划线
					  ,'del' //删除线
					  ,'|' //分割线
					  ,'left' //左对齐
					  ,'center' //居中对齐
					  ,'right' //右对齐
					  ,'|' 
					  ,'link' //超链接
					  ,'unlink' //清除链接
					  ,'face' //表情
					  ,'image' //插入图片
					  //,'help' //帮助
				]
   	  				,height: 250
   	  			});
   	});
  
});


function questionPublish(){
	$("#text").val(layedit.getContent(index));
	var url = Const.apiUrl + '/tQuestion/questionSave';
	var param = new Object();
	param.content = $('form')[0].content.value;
	param.userId = userId;
	param.topicId = topicId;
	param.title = title;
	if(param.content == undefined || param.content == ''){
		TmplUtils.showMsgFail('请输入内容');
	}
	View.get(url,param,function(resp){
		TmplUtils.showMsgSuccess('保存成功!');
		tmpl.refresh();
		/* //调用Java的back()方法
	    var result =window.android.back();
	    document.getElementById("p").innerHTML=result; */
		return resp;
	},function(){
		TmplUtils.showMsgFail('保存失败!');
		return false;
	});
	return true;
}

$(function (){
	/*  $(document).unbind("click"); */
		var form = layui.form;
	 
	tmpl = new View.Tmpl({
		"container" : $("#content"),
		"tmpl" : $("#tmpl").html()
	});
	tmpl.onload(function(attrs, param){
		var _t = this;
		_t.bind(function(callback){
			callback.call(_t,{});
			index =layedit.build('richText'); //建立编辑器
		});
	});

})

</script>

</html>