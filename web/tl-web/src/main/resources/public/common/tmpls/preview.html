<script type="text/tmpl">
    <div class="title">
        <h3>预览</h3>
{{#     if(d.canEdit){ }}
        <div class="layui-form switchTest">
			<input type="checkbox" name="open" lay-skin="switch" lay-filter="switchTest" lay-text="修改|查看" id="switchBtn">
		</div>
{{#     } }}
        <div class="operate layui-form">
            <button class="layui-btn layui-btn-mini layui-btn-normal" id="preservationBtn" style="display: none;" onclick="if(TmplUtils.check('preview')){ {{= d.saveClick }}(); }">
                保存
        </button>
            <button class="layui-btn layui-btn-mini layui-btn-primary" id="closePreview">
                关闭
        </button>
        </div>
    </div>
    <div class="text" id="htmlCont">
        <form class="layui-form" id="preview" action="">
            <input type="hidden" name ="id" value="{{=d.data.id}}"/>
{{#
             var dataStr = JSON.stringify(d.data);
             layui.each(d.attrs, function(index, attr){
                 var fun =new Function("return "+dataStr+"."+attr.prop+";");
                 var propValue = "";
                 try{
                     propValue = fun();
                 }catch(e){
                 }
}}
{{# if(attr.hidden && attr.hidden.indexOf('preview') >- 1){ }}
    <div class="layui-form-item" style="display:none">
{{# }else{ }}
    <div class="layui-form-item">
{{# } }}
{{#             if(attr.type == "date"){
}}

                    <label class="layui-form-label">{{ attr.alias }}：</label>
                    <div class="layui-input-block">
                        <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}" data-alias="{{= attr.alias }}"  disabled  data-editable="{{ attr.editable}}"
                            lay-verify="date" value="{{=Utils.getDate(propValue)}}"  autocomplete="off"
                            class="layui-input" onclick="layui.laydate({elem: this})">
                    </div>
					</div>
{{#            }else if(attr.type == "datetime"){ }}
                    <label class="layui-form-label">{{ attr.alias }}：</label>
                    <div class="layui-input-block">
                        <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}" disabled data-alias="{{= attr.alias}}" data-editable="{{ attr.editable}}"
                            lay-verify="date" value="{{=Utils.getDatetime(propValue)}}"  autocomplete="off"
                            class="layui-input" onclick="layui.laydate({elem: this,istime: true,format: 'YYYY-MM-DD hh:mm:ss'})">
                    </div>
					</div>
{{#            }else if(attr.type == "time"){ }}
                    <label class="layui-form-label">{{ attr.alias }}：</label>
                    <div class="layui-input-block">
                        <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}" disabled data-alias="{{= attr.alias}}" data-editable="{{ attr.editable}}"
                            lay-verify="date" value="{{=Utils.getTime(propValue)}}"  autocomplete="off"
                            class="layui-input" >
                    </div>
					</div>
{{#            }else if(attr.type == "enum"){
}}
            {{#
                var keyVals = [];
                if(attr.dict_key){
                    keyVals = TmplUtils.__getEnumKeyVals(d.enums,attr.dict_key.split('.')[0],attr.dict_key.split('.')[1]);
                }else{
                    keyVals = TmplUtils.__getEnumKeyVals(d.enums,d.table,attr.prop);
                }

            }}
             <label class="layui-form-label">{{ attr.alias }}：</label>
            {{# if(keyVals.length == 0 && !attr.enum_url){ }}
                  <div class="layui-input-block">
                        <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}"
                             value="{{= propValue}} "  placeholder="" data-alias="{{= attr.alias }}"  data-verify="{{ attr.verify }}" disabled data-editable="{{ attr.editable }}" autocomplete="off" class="layui-input">
                  </div>
            {{# }else{ }}
                    <div class="layui-input-block">
                        <select name="{{=attr.prop}}" class="_tip" data-alias="{{= attr.alias }}" data-prop="{{=attr.prop}}" lay-filter="{{=attr.prop+1 }}" data-verify="{{ attr.verify }}" data-desc="{{= attr.desc }}" data-editable="{{ attr.editable }}" {{# if(1==attr.enum_search){ }} lay-search {{# } }} data-enumurl="{{ attr.enum_url }}" data-key="{{propValue}}" data-enumparam="{{attr.enum_param}}" disabled>
                            <option value="">--请选择--</option>
                   {{# layui.each(keyVals, function(index, keyVal){ }}
                           {{# if( keyVal.key==propValue){ }}
                           <option selected="true" value="{{ keyVal.key }}">{{= keyVal.val }}</option>
                           {{# }else{ }}
                           <option value="{{ keyVal.key }}">{{= keyVal.val }}</option>
                           {{# } }}
                    {{# }); }}
                        </select>
                    </div>
             {{# } }}
                </div>

{{#            }else if(attr.type == "enumLink"){
}}
    <label class="layui-form-label">{{ attr.alias }}：</label>
        <div class="layui-input-block">
    {{#
                var enumUrls = attr.enum_urls.split(',');
                var values = [];
                if(propValue){
                    values = propValue.split(",");
                }
                for(var k=0;k< enumUrls.length;k++){ }}

                   <select name="{{=attr.prop}}-|-{{k}}" data-type="{{ attr.type }}" data-prop="{{=attr.prop}}" data-alias="{{= attr.alias }}" data-editable="{{ attr.editable }}",class="_tip" lay-filter="{{=attr.prop}}-|-{{k}}" data-desc="{{= attr.desc }}" data-verify="{{ attr.verify }}" data-len="{{attr.len}}" data-verifyfun="{{ attr.verify_fun }}" {{# if(1==attr.enum_search){ }} lay-search {{# } }} data-enumurl="{{ enumUrls[k] }}" disabled data-key="{{values[k]}}" data-enumparam="{{attr.enum_param}}">

               <option value="">--请选择--</option>
               </select>
               {{#      }
                }}
                    </div>
                </div>
{{#            }else if(attr.type == "multipleChoice"){
}}
            <label class="layui-form-label">{{ attr.alias }}：</label>
            <div class="layui-input-inline layui-inline-checkbox">
             <span data-prop="{{=attr.prop}}" class=" _multipleChoice" data-choiceurl="{{attr.choice_url}}" data-choiceparam="{{attr.choice_param}}" data-keys="{{propValue}}" data-editable="{{attr.editable}}"></span>
            {{# if(attr.verify && attr.verify.indexOf("required") > -1){ }}
                <span class="identifier">*</span>
            {{# } }}
            </div>
      </div>
{{#            }else if(attr.type == "text"){ }}
                            <label class="layui-form-label">{{ attr.alias }}：</label>
                            <div class="layui-input-block">
                                <textarea name="{{= attr.prop }}" data-type="{{ attr.type }}" data-alias="{{= attr.alias }}"  data-verify="{{ attr.verify }}" disabled  data-editable="{{ attr.editable }}" placeholder="" class="layui-textarea">{{= propValue}}</textarea>
                            </div>
                      </div>
{{#            }else if(attr.type == "money"){ }}
                            <label class="layui-form-label">{{ attr.alias }}：</label>
                            <div class="layui-input-block">
                                <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}"
                                     value="{{=Utils.numberToMoney(propValue,attr.digit)}}" onblur="$(this).val(Utils.numberToMoney($(this).val(),{{ attr.digit }}));"  placeholder="" data-verify="{{ attr.verify }}" data-alias="{{= attr.alias }}" disabled data-editable="{{ attr.editable }}" autocomplete="off" class="layui-input">
                            </div>
                      </div>
{{#             }else{ }}
                            <label class="layui-form-label">{{ attr.alias }}：</label>
                            <div class="layui-input-block">
                                <input type="text" name="{{= attr.prop }}" data-type="{{ attr.type }}"
                                     value="{{= propValue}}"  placeholder="" data-verify="{{ attr.verify }}" data-alias="{{= attr.alias }}" disabled data-editable="{{ attr.editable }}" autocomplete="off" class="layui-input">
                            </div>
                      </div>
{{#             } }}
{{#
            });
}}
        </form>
    </div>
</script>